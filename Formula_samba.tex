\XeTeXinputencoding "GB2312"

\documentclass[a4paper]{article} %,11pt,twoside,dvipdf]{article}

\usepackage{xeCJK}%根据自己的需要加载宏包。
%\setmainfont{Times New Roman}
%\setCJKmainfont{Adobe Kaiti Std}
%\setCJKmainfont{SimSun}
%\setCJKmainfont{KaiTi_GB2312}
%\setCJKmainfont{WenQuanYi Micro Hei}
%\setmainfont{Adobe Kaiti Std}%
\usepackage{indentfirst}             % 首行缩进
\iffalse
\usepackage[%paperwidth=18.4cm, paperheight= 26cm,
            body={14.6true cm,22true cm},
            twosideshift=0 pt,
            %headheight=1.0true cm
            ]{geometry}
\fi

\usepackage[colorlinks,
            linkcolor=red,
            anchorcolor=blue,
            citecolor=green
            ]{hyperref}

%\usepackage[colorlinks,linkcolor=black,hyperindex,CJKbookmarks,dvipdfm]{hyperref}
%\usepackage{tikz}
\usepackage{graphics,graphicx}
\usepackage{mathrsfs}
\usepackage{amsmath}
\usepackage{subfigure}
\usepackage{booktabs}
\usepackage{amsthm}
\usepackage{listings}
\usepackage{setspace}
\usepackage{subfigure}
\usepackage{pgfplots}
%\usepackage{cite}
\usetikzlibrary{shapes.geometric, arrows,matrix,positioning,calc}
\intextsep=8pt plus 3pt minus 1pt
\tikzstyle{startstop} = [rectangle, rounded corners, minimum width=2cm, minimum height=1cm,text centered, draw=black, fill=red!30]

\usepackage[perpage,symbol]{footmisc}% 脚注控制
\usepackage[sf]{titlesec}            % 控制标题
\usepackage{titletoc}                % 控制目录
\usepackage{fancyhdr}                % 页眉页脚
\usepackage{type1cm}                 % 控制字体大小
\usepackage{indentfirst}             % 首行缩进
\usepackage{makeidx}                 % 建立索引
\usepackage{textcomp}                % 千分号等特殊符号
\usepackage{layouts}                 % 打印当前页面格式
%\usepackage{bbding}                  % 一些特殊符号
\usepackage{cite}                    % 支持引用
\usepackage{color,xcolor}            % 支持彩色文本、底色、文本框等
%%\lstset{language=,tabsize=4, keepspaces=true,
%    xleftmargin=2em,xrightmargin=2em, aboveskip=1em,
%    backgroundcolor=\color{lightgray},    % 定义背景颜色
%    frame=none,                      % 表示不要边框
%    keywordstyle=\color{blue}\bfseries,
%    breakindent=22pt,
%    numbers=left,stepnumber=1,numberstyle=\tiny,
%    basicstyle=\footnotesize,
%    showspaces=false,
%    flexiblecolumns=true,
%    breaklines=true, breakautoindent=true,breakindent=4em,
%    escapeinside={/*@}{@*/}
%}
%
%\usepackage{times}     % 包括 Times Roman + Helvetica + Courier
%%\usepackage{palatino} % 包括 Palatino + Helvetica + Courier
%%\usepackage{newcent}  % 包括 New Century Schoolbook + Avant Garde + Courier
%%\usepackage{bookman}  % 包括 Bookman + Avant Garde + Courier
%%%%%%%%%% 数学符号公式 %%%%%%%%%%
\usepackage{latexsym}
\usepackage{amsmath}                 % AMS LaTeX宏包
\usepackage{amssymb}                 % 用来排版漂亮的数学公式
\usepackage{amsbsy}
\usepackage{amsthm}
\usepackage{amsfonts}
\usepackage{mathrsfs}                % 英文花体字体
\usepackage{bm}                      % 数学公式中的黑斜体
\usepackage{relsize}                 % 调整公式字体大小?
%%%%%%%%%%% 图形支持宏包 %%%%%%%%%%
%%\ifx\pdfoutput\undefined             % 用latex或pdflatex编译
%%  \usepackage[dvips]{graphicx}       % 将eps格式的图片放在figures目录下
%%\else                                % 在setup/format.tex中用以下命令注明路径：
%%  \usepackage[pdftex]{graphicx}      % \graphicspath{{figures/}}
%%\fi
%%%\usepackage{subfigure}
%\usepackage{epsfig}                  % 支持eps图像
%%\usepackage{picinpar}               % 图表和文字混排宏包
%%\usepackage[verbose]{wrapfig}       % 图表和文字混排宏包
%%\usepackage{eso-pic}                % 向文档的部分页加n副图形, 可实现水印效果
%%\usepackage{eepic}                  % 扩展的绘图支持
%%\usepackage{curves}                 % 绘制复杂曲线
%%\usepackage{texdraw}                % 增强的绘图工具
%%\usepackage{treedoc}                % 树形图绘制
%%\usepackage{pictex}                 % 可以画任意的图形
%\usepackage{hyperref}
%
%%%%%%%%%%% 一些距离设置 %%%%%%%%%%%
\setlength{\floatsep}{10pt plus 3pt minus 2pt}       % 图形之间或图形与正文之间的距离
\setlength{\abovecaptionskip}{2pt plus 1pt minus 1pt}% 图形中的图与标题之间的距离
\setlength{\belowcaptionskip}{3pt plus 1pt minus 2pt}% 表格中的表与标题之间的距

%%%%%%%%%% 纸张和页面的大小 %%%%%%%%%%
\paperwidth   20 true cm            % 纸张宽
\paperheight  30 true cm            % 纸张高
\textwidth    10 true cm            % 正文宽
\textheight   20 true cm            % 正文高
\headheight      14pt               % 页眉高
\headsep         16pt               % 页眉距离
\footskip        27pt               % 页脚距离
\marginparsep    10pt               % 边注区距离
\marginparwidth  100pt              % 边注区宽
\makeindex                           % 生成索引
\pagestyle{fancy}                    % 页眉页脚风格
\fancyhf{}                           % 清空当前页眉页脚的默认设置


%\newcommand{\song}{\CJKfamily{SimSun}} % 宋体
%\newcommand{\hei}{\CJKfamily{hei}}   % 黑体
%\newcommand{\fs}{\CJKfamily{fs}}     % 仿宋
%\newcommand{\kai}{\CJKfamily{kai}}   % 楷体
%%%%%%%%% 定理类环境的定义 %%%%%%%%%%
%% 必须在导入中文环境之后
\newtheorem{example}{例}             % 整体编号
\newtheorem{algorithm}{算法}
\newtheorem{theorem}{定理}[section]  % 按 section 编号
\newtheorem{definition}{定义}
\newtheorem{axiom}{公理}
\newtheorem{property}{性质}
\newtheorem{proposition}{命题}
\newtheorem{lemma}{引理}
\newtheorem{corollary}{推论}
\newtheorem{remark}{注解}
\newtheorem{condition}{条件}
\newtheorem{conclusion}{结论}
\newtheorem{assumption}{假设}
%%%%%%%%%% 一些重定义 %%%%%%%%%%
%% 必须在导入中文环境之后
\renewcommand{\contentsname}{目录}     % 将Contents改为目录
\renewcommand{\abstractname}{摘\ \ 要} % 将Abstract改为摘要

\renewcommand{\refname}{参考文献}      % 将References改为参考文献
\renewcommand{\indexname}{索引}
\renewcommand{\figurename}{图}
\renewcommand{\tablename}{表}
\renewcommand{\appendixname}{附录}
\renewcommand{\proofname}{\hei 证明}
\renewcommand{\algorithm}{\hei 算法}
\bibliographystyle{plain}
\usetikzlibrary{shapes.geometric, arrows,matrix,positioning,calc}

%%%%%%%%%% 重定义字号命令 %%%%%%%%%%
\newcommand{\yihao}{\fontsize{26pt}{36pt}\selectfont}       % 一号, 1.4倍行距
\newcommand{\erhao}{\fontsize{22pt}{28pt}\selectfont}       % 二号, 1.25倍行距
\newcommand{\xiaoer}{\fontsize{18pt}{18pt}\selectfont}      % 小二, 单倍行距
\newcommand{\sanhao}{\fontsize{16pt}{24pt}\selectfont}      % 三号, 1.5倍行距
\newcommand{\xiaosan}{\fontsize{15pt}{22pt}\selectfont}     % 小三, 1.5倍行距
\newcommand{\sihao}{\fontsize{14pt}{21pt}\selectfont}       % 四号, 1.5倍行距
\newcommand{\xiaosi}{\fontsize{12pt}{18pt}\selectfont}      % 小四, 1.5倍行距
\newcommand{\dawu}{\fontsize{11pt}{11pt}\selectfont}        % 大五, 单倍行距
\newcommand{\wuhao}{\fontsize{10.5pt}{10.5pt}\selectfont}   % 五号, 单倍行距
\newtheorem{exmp}{算例}[section]
\renewcommand\thesection{\arabic{section}.}
\graphicspath{{picture/}}


\title{samba公式推导}

\begin{document} 

\maketitle

\section{二维控制方程}

运动方程：
\begin{equation}
  \frac{d(r,z)}{dt}=(u,v)
\end{equation}

质量守恒：
\begin{equation}\label{eq:38}
  \frac{dm}{dt}=0
\end{equation}

动量守恒方程：
\begin{equation}\label{eq:3}
  \begin{array}{l}
	\displaystyle \rho \frac{du}{dt}=\frac{\partial \sigma _{rr}}{\partial r}+ \frac{\partial s_{rz}}{\partial z}\\[0.3cm]
  \displaystyle \rho \frac{dv}{dt}=\frac{\partial \sigma _{zz}}{\partial z}+ \frac{\partial s_{rz}}{\partial r}\\
  \end{array}
  \end{equation}

能量守恒方程：
\begin{equation}
  \begin{array}{l}
	\displaystyle \rho \frac{de}{dt}=\sigma _{rr}\frac{\partial u}{\partial r}+\sigma_{zz}\frac{\partial v}{\partial z}+s_{rz}\left( \frac{\partial u}{\partial z}+\frac{\partial v}{\partial r}\right)\\[0.3cm]
	\displaystyle = -p\frac{dV}{dt}+ s_{rr}\frac{\partial u}{\partial r}+s_{zz}\frac{\partial v}{\partial z}+s_{rz}\left( \frac{\partial u}{\partial z}+\frac{\partial v}{\partial r}\right)\\
	\end{array}
	\end{equation}

本构方程：
\begin{equation}
  \begin{array}{l}
	\displaystyle \frac{ds_{rr}}{dt}=2\mu \left(\frac{\partial u}{\partial r}-\frac{1}{3}\nabla \cdot \vec{u} \right) +s_{rz}\left(\frac{\partial u}{\partial z}-\frac{\partial v}{\partial r}\right)\\[0.3cm]
	\displaystyle \frac{ds_{zz}}{dt}=2\mu \left(\frac{\partial v}{\partial z}-\frac{1}{3}\nabla \cdot \vec{u} \right) -s_{rz}\left(\frac{\partial u}{\partial z}-\frac{\partial v}{\partial r}\right)\\[0.3cm]
	\displaystyle \frac{ds_{rz}}{dt}=\mu \left(\frac{\partial u}{\partial r}+\frac{\partial v}{\partial z}\right) + \frac{s_{rr}-s_{zz}}{2}\left(\frac{\partial u}{\partial z}-\frac{\partial v}{\partial r}\right)\\
  \end{array}
  \end{equation}

Von Mises屈服条件：
\begin{equation}
  \frac{3}{2}(s_{rr}^2+s_{zz}^2+s_{\theta \theta}^2+2s_{xy}^2)\le (Y^0)^2
\end{equation}

\section{柱坐标下控制方程}
在正交曲线坐标系$(\xi_\alpha,\xi_\beta,\xi_\gamma)$中，存在坐标变换
\begin{equation}
  x_i=x_i(\xi_\alpha,\xi_\beta,\xi_\gamma),\hspace{0.2cm} i=1,2,3
  \end{equation}
由于
\begin{equation}
  \frac{\partial (x_1,x_2,x_3)}{\partial (\xi_\alpha, \xi_\beta, \xi_\gamma)}\ne 0
\end{equation}
因此可以解出
\begin{equation}
  \xi_\nu = \xi_\nu(x_1,x_2,x_3), \hspace{0.2cm} \nu=1,2,3
\end{equation}
定义Lame系数
\begin{equation}
  h_\nu =\left[ \sum_{i=1}^3\left(\frac{\partial x_i}{\partial \xi_\nu}\right)^2\right]^{\frac{1}{2}},\hspace{0.2cm} \nu=\alpha,\beta,\gamma
\end{equation}
可以推出曲线坐标系下标量$\phi$的梯度表达式
\begin{equation}
  \nabla \phi = \frac{1}{h_\alpha}\frac{\partial \phi}{\partial \xi_\alpha} \bm{j}_\alpha +\frac{1}{h_\beta}\frac{\partial \phi}{\partial \xi_\beta}\bm{j}_\beta +\frac{1}{h_\gamma}\frac{\partial \phi}{\partial \xi_\gamma}\bm{j}_\gamma
  \end{equation}
  对于向量函数$\bm{f}$ 旋度表达式为
  \begin{equation}
	\begin{aligned}
	\nabla \times \bm{f}& =\frac{1}{h_\beta h_\gamma} \left[\frac{\partial}{\partial \beta}(h_\gamma f_\gamma)- \frac{\partial }{\partial \gamma} (h_\beta f_\beta)\right]\bm{j}_\alpha \\
	&+ \frac{1}{h_\gamma h_\alpha} \left[\frac{\partial}{\partial \gamma}(h_\alpha f_\alpha)- \frac{\partial }{\partial \alpha} (h_\gamma f_\gamma)\right]\bm{j}_\beta\\
&+ \frac{1}{h_\alpha h_\beta} \left[\frac{\partial}{\partial \alpha}(h_\beta f_\beta)- \frac{\partial }{\partial \beta} (h_\alpha f_\alpha)\right]\bm{j}_\gamma
\end{aligned}
\end{equation}
散度表达式
\begin{equation}
  \nabla \cdot \bm{f} =\frac{1}{h_\alpha h_\beta h_\gamma}\left[\frac{\partial}{\partial \xi_\alpha}(f_\alpha h_\beta h_\gamma) +\frac{\partial}{\partial \xi_\beta}(f_\beta h_\gamma h_\alpha) +\frac{\partial}{\partial \xi_\gamma}(f_\gamma h_\alpha h_\beta)\right]
\end{equation}

对于曲线坐标系中的张量$\bm{T}$ 
\begin{equation}
  \bm{T} = \left( 
  \begin{array}{lll}
	T_{\alpha \alpha}& T_{\alpha \beta} & T_{\alpha \gamma}\\
	T_{\beta \alpha}& T_{\beta \beta} & T_{\beta \gamma}\\
	T_{\gamma \alpha}& T_{\gamma \beta} & T_{\gamma \gamma}\\
	\end{array}
	\right)
	\end{equation}
	散度三个分量为
	\begin{equation}
	  \begin{aligned}
	 & (\nabla \cdot \bm{T})_\alpha = \frac{1}{h_\alpha h_\beta h_\gamma} \left[ \frac{\partial T_{\alpha \alpha} h_\beta h_\gamma}{\partial \xi_\alpha}+\frac{\partial T_{\beta \alpha} h_\gamma h_\alpha}{\partial \xi_\beta}+ \frac{\partial T_{\gamma \alpha} h_\alpha h_\beta}{\partial \xi_\gamma}\right]\\
	  &+\frac{T_{\alpha \beta}}{h_\alpha h_\beta} \frac{\partial h_\alpha}{\partial \xi_\beta} +\frac{T_{\alpha \gamma}}{h_\alpha h_\gamma}\frac{\partial h_\alpha}{\partial \xi_\gamma}-\frac{T_{\beta \beta}}{h_\alpha h_\beta}\frac{\partial h_\beta}{\partial \xi_\alpha} - \frac{T_{\gamma \gamma}}{h_\alpha h_\gamma}\frac{\partial h_\gamma}{\partial \xi_\alpha}
	  \end{aligned}
	\end{equation}

	\begin{equation}
	  \begin{aligned}
	 & (\nabla \cdot \bm{T})_\beta = \frac{1}{h_\alpha h_\beta h_\gamma} \left[ \frac{\partial T_{\alpha \beta} h_\beta h_\gamma}{\partial \xi_\alpha}+\frac{\partial T_{\beta \beta} h_\gamma h_\alpha}{\partial \xi_\beta}+ \frac{\partial T_{\gamma \beta} h_\alpha h_\beta}{\partial \xi_\gamma}\right]\\
	  &+\frac{T_{\beta \alpha}}{h_\alpha h_\beta} \frac{\partial h_\beta}{\partial \xi_\alpha} +\frac{T_{\beta \gamma}}{h_\beta h_\gamma}\frac{\partial h_\beta}{\partial \xi_\gamma}-\frac{T_{\alpha \alpha}}{h_\alpha h_\beta}\frac{\partial h_\alpha}{\partial \xi_\beta} - \frac{T_{\gamma \gamma}}{h_\beta h_\gamma}\frac{\partial h_\gamma}{\partial \xi_\beta}
	  \end{aligned}
	\end{equation}

	\begin{equation}
	  \begin{aligned}
	 & (\nabla \cdot \bm{T})_\gamma = \frac{1}{h_\alpha h_\beta h_\gamma} \left[ \frac{\partial T_{\alpha \gamma} h_\beta h_\gamma}{\partial \xi_\alpha}+\frac{\partial T_{\beta \gamma} h_\gamma h_\alpha}{\partial \xi_\beta}+ \frac{\partial T_{\gamma \gamma} h_\alpha h_\beta}{\partial \xi_\gamma}\right]\\
	  &+\frac{T_{\gamma \alpha}}{h_\gamma h_\alpha} \frac{\partial h_\gamma}{\partial \xi_\alpha} +\frac{T_{ \gamma \beta}}{h_\beta h_\gamma}\frac{\partial h_\gamma}{\partial \xi_\beta}-\frac{T_{\alpha \alpha}}{h_\alpha h_\gamma}\frac{\partial h_\alpha}{\partial \xi_\gamma} - \frac{T_{\beta \beta}}{h_\beta h_\gamma}\frac{\partial h_\beta}{\partial \xi_\gamma}
	  \end{aligned}
	\end{equation}
	具体求解过程见附录\ref{xx}。





  \section{离散方法}
  \subsection{时间离散：预估校正方法}
  \hspace{1cm}
  对于如下形式方程
  \begin{equation} \label{eq:time}
  \frac{\partial U}{\partial t}=F(U)
\end{equation}
预估步：
\begin{equation}
  \frac{U^{n+\frac{1}{2}}-U^n}{\frac{1}{2}\Delta t} = F(U^n)
\end{equation}
校正步：
\begin{equation}
  \frac{U^{n+1}-U^n}{\Delta t} = F(U^{n+\frac{1}{2}})
\end{equation}

\subsection{空间离散方法}

\begin{figure}
  \centering
  \begin{tikzpicture}
	\coordinate (A) at (2,0);
	\coordinate (B) at (8,0.0);
	\coordinate (C) at (8.2,6.3);
	\coordinate (D) at (2.3,5.9);

	\coordinate (O) at (20.5/4, 12.2/4);
	\coordinate (AB) at (5, 0);
	\coordinate (BC) at (8.1, 3.15);
	\coordinate (CD) at (5.25, 6.1);
	\coordinate (AD) at (2.15, 2.95);

	\coordinate (AB2) at (10.125/2, 3.05/2);
	\coordinate (BC2) at (13.225/2, 3.1);
	\coordinate (CD2) at (10.375/2, 9.15/2);
	\coordinate (AD2) at (7.275/2, 3.);

	\coordinate (OA) at (3.56875,1.5);
	\coordinate (OB) at (6.55625,1.55);
	\coordinate (OC) at (6.66875,4.65);
	\coordinate (OD) at (3.705625,4.5);


\draw [dashed,line width=1.6pt, color=black!40] (OA)--(AB2)--(OB);
\draw [dashed,line width=1.6pt, color=black!40] (OB)--(BC2)--(OC);
\draw [dashed,line width=1.6pt, color=black!40] (OC)--(CD2)--(OD);
\draw [dashed,line width=1.6pt, color=black!40] (OD)--(AD2)--(OA);


\draw [line width=1pt, color=black!80] (A)--(B);
\draw [line width=1pt, color=black!80] (B)--(C);
\draw [line width=1pt, color=black!80] (C)--(D);
\draw [line width=1pt, color=black!80] (D)--(A);

%\draw [line width=1pt,dashed,fill=black!10!red!10] (OA)--(OB)--(OC)--(OD);
\fill[fill=black!10!red!10] (OA)--(OB)--(OC)--(OD);

\draw [line width=0.8pt, color=black!40] (O)--(AB);
\draw [line width=0.8pt, color=black!40] (O)--(BC);
\draw [line width=0.8pt, color=black!40] (O)--(CD);
\draw [line width=0.8pt, color=black!40] (O)--(AD);


%\draw [->>,line width=1.4pt, color=black!80!blue!80] (AB2)--(BC2);
%\draw [->>,line width=1.4pt, color=black!80!blue!80] (BC2)--(CD2);
%\draw [->>,line width=1.4pt, color=black!80!blue!80] (CD2)--(AD2);
%\draw [->>,line width=1.4pt, color=black!80!blue!80] (AD2)--(AB2);

\node at (10.125/2-0.2,3.05/2-0.2) { \romannumeral 1};
\node at (6.55625+0.2,1.55-0.2) { \romannumeral 2};
\node at (13.225/2+0.2,3.1+0.2) { \romannumeral 3};
\node at (6.66875+0.2,4.65+0.2) { \romannumeral 4};
\node at (10.375/2-0.2,9.15/2+0.2) { \romannumeral 5};
\node at (3.705625-0.2,4.5+0.2) { \romannumeral 6};
\node at (7.275/2-0.2,3+0.2) { \romannumeral 7};
\node at (3.56875-0.2,1.5-0.2) { \romannumeral 8};

\node at (20.5/4+0.2, 12.2/4+0.2) {\large O};
\node at (5,-0.3) {\large 1};
\node at (8.4,3.15) {\large 2};
\node at (5.25,6.4) {\large 3};
\node at (1.85,2.95) {\large 4};

\node at (3.,1.55) {\large \uppercase\expandafter{\romannumeral 4}};
\node at (3.,4.75) {\large \uppercase\expandafter{\romannumeral 3}};
\node at (7.3,4.95) {\large \uppercase\expandafter{\romannumeral 2}};
\node at (7.3,1.55) {\large \uppercase\expandafter{\romannumeral 1}};

\end{tikzpicture}
\caption{有限体积方法求解动量方程控制单元示意图}
\label{fig:1}
\end{figure}

%\subsubsection{
%运动方程离散}
%
%预估步:
%\begin{equation}
%  \frac{(r,z)^{n+\frac{1}{2}}-(r,z)^n}{\frac{1}{2}\Delta t} = (u,v)^n
%\end{equation}
%
%和Eq.(\ref{eq:time})不同，$(u,v)^{n+1/2}$不能直接由$(r,z)^{n+1/2}$求出。这里需要由动量方程求得$(u,v)^{n+1}$，然后取平均值
%\begin{equation}
%  (u,v)^{n+\frac{1}{2}}=\frac{(u,v)^{n}+(u,v)^{n+1}}{2}
%  \end{equation}
%
%校正步：
%\begin{equation}
%  \frac{(r,z)^{n+1}-(r,z)^n}{\Delta t} = (u,v)^{n+\frac{1}{2}}
%\end{equation}
%
\subsubsection{动量方程离散}

1.有限体积离散

采用如图\ref{fig:1}所示非结构四边形单元，Wilkins在1963年首先通过有限体积方法得到Wilkins格式\cite{wilkins1963calculation}。点$\romannumeral 1$，$\romannumeral 3$，$\romannumeral 5$，$\romannumeral 7$分别为线O1，O2，O3，O4的中点，$\romannumeral 2$，$\romannumeral 4$，$\romannumeral 6$，$\romannumeral 8$分别为区域$\uppercase\expandafter{\romannumeral 1}$-$\uppercase\expandafter{\romannumeral 4}$的几何中心。

对于动量离散方程\ref{eq:3}，在八边形面回路$\Omega =\romannumeral 1 \rightarrow \romannumeral 2 \rightarrow \cdots \rightarrow \romannumeral 7 \rightarrow \romannumeral 1$上积分：
\begin{equation}\label{eq:31}
	\int_\Omega \rho \frac{du}{dt} d\Omega = \int_{\Omega}  \frac{\partial \sigma _{rr}}{\partial r}+ \frac{\partial s_{rz}}{\partial z} d\Omega 
  \end{equation}

  \begin{equation}
	\int_{\Omega} \rho \frac{dv}{dt} d\Omega =  \int_{\Omega} \frac{\partial \sigma _{zz}}{\partial z}+ \frac{\partial s_{rz}}{\partial r} d\Omega 
  \end{equation}

以方程\ref{eq:31}为例，左侧积分可以近似为
\begin{equation}
  \int_\Omega \rho \frac{du}{dt} d\Omega = M \frac{du_o}{dt}
\end{equation}
其中
\begin{equation}
  M=\frac{1}{4}(A_{ \uppercase\expandafter{\romannumeral 1}}\rho_{ \uppercase\expandafter{\romannumeral 1}}+A_{ \uppercase\expandafter{\romannumeral 2}}\rho_{ \uppercase\expandafter{\romannumeral 2}}+A_{ \uppercase\expandafter{\romannumeral 3}}\rho_{ \uppercase\expandafter{\romannumeral 3}}+A_{ \uppercase\expandafter{\romannumeral 4}}\rho_{ \uppercase\expandafter{\romannumeral 4}})
\end{equation}

右侧积分根据Green公式：
\begin{equation}
  \int_{\Omega} \text{grad} f d\Omega =\oint_{\partial \Omega } f \overrightarrow{n}dl
\end{equation}
有
\begin{equation}
  \int_{\Omega} \frac{\partial \sigma _{rr}}{\partial r}+ \frac{\partial s_{rz}}{\partial z} d\Omega =- \oint_{\partial \Omega} \sigma_{rr} dz + \oint_{\partial \Omega} s_{rz} dr
\end{equation}
积分
\begin{equation}
  \int_{vii}^{i} \sigma _{rr} dz \approx \frac{1}{2} \sigma_{rrI} (z_2-z_1)
\end{equation}
同理可得
\begin{equation}
  -\oint_{\partial \Omega} \sigma_{rr} dz + \oint_{\partial \Omega} s_{rz} dr = \frac{1}{2} \sum_{i=1}^4 s_{rzi}(r_{i+1}-r_{i}) -\sigma_{rri}(z_{i+1}-z_i)
\end{equation}

得到wilkins格式：
\begin{equation}\label{eq:34}
  \frac{du_o}{dt}=\frac{1}{2M} \left[ \sum_{i=1}^4 s_{rzi}(r_{i+1}-r_{i}) -\sigma_{rri}(z_{i+1}-z_i)\right]
\end{equation}

2:有限元离散

该格式同样可以通过有限元方法得出(Lascaux 1973年）\cite{lascauxapplication}。控制体同样取如图\ref{fig:1}，以$IV$区为例，可以化作有限元的单元积分：
\begin{equation}\label{eq:44}
  \int_{\Omega_{IV}}\rho \frac{du}{dt} \phi_O  d\Omega = \int_{\Omega_{IV}} \left(\frac{\partial \sigma_{rr}}{\partial r}+\frac{\partial s_{rz}}{\partial z}\right) \phi_O d\Omega
\end{equation}
其中$\phi_o$在$IV$区为
\begin{equation}
  \phi_O = \phi_c= \frac{1}{4}(1+\xi)(1+\eta) 
\end{equation} 
为基函数，$i=a,b,c,d$
其中 $(\xi,\eta)=(-1,-1),(1,-1),(1,1),(-1,1)$ 
\begin{equation}
  \begin{array}{l}
  \displaystyle u=\sum_{i=a}^{d}u_i \phi_i\\
  \displaystyle r=\sum_{i=a}^{d}r_i \phi_i\\
  \displaystyle z=\sum_{i=a}^{d}z_i \phi_i\\
\end{array}
\end{equation}
公式\ref{eq:44}左侧可以化为：
\begin{equation}\label{eq:32}
  \begin{aligned}
	\int_{\Omega_{IV}}\rho \phi_c \frac{du}{dt} d\Omega & =   \frac{du}{dt} \int_{\Omega_{IV}}\rho  \phi_c d \Omega\\
  &=  \frac{du}{dt}M 
\end{aligned}
\end{equation}
其中
\begin{equation}
  M=\int_{-1}^{1}\int_{-1}^{1}\rho  \phi_c J d \xi d\eta
  \end{equation}
$J$为Jacobi矩阵
\begin{equation}
  \begin{aligned}
  J=&\left\|\begin{array}{ll}
	\frac{\partial r}{\partial \xi} & \frac{\partial r}{\partial \eta} \\
	\frac{\partial z}{\partial \xi} & \frac{\partial z}{\partial \eta} \\
  \end{array}
  \right\|\\
  =& \frac{\partial r}{\partial \xi}\frac{\partial z}{\partial \eta}-\frac{\partial r}{\partial \eta}\frac{\partial z}{\partial \xi}\\
  =& \frac{1}{16} \sum _{i=a}^d r_i \xi_i(1+\eta_i \eta)\sum_{i=a}^d z_i \eta_i (1+\xi_i \xi)\\
  -& \frac{1}{16} \sum _{i=a}^d r_i \eta_i(1+\xi_i \eta)\sum_{i=a}^dz_i \xi_i (1+\eta_i \eta)\\
  =& \frac{1}{16} [(r_2+r_3-r_1-r_4)+\eta(r_1+r_3-r_2-r_4)]\\
  &[(z_3+z_4-z_2-z_1)+\xi(z_1+z_3-z_2-z_4)]\\
  -& \frac{1}{16}[(z_2+z_3-z_1-z_4)+\eta(z_1+z_3-z_2-z_4)]\\
 & [(r_3+r_4-r_2-r_1)+\xi(r_1+r_3-r_2-r_4)]\\
  =&\frac{1}{8}[(z_1-z_3)(r_4-r_2)+(z_2-z_4)(r_1-r_3)\\
  &+(\xi-\eta) (r_4-r_3)(z_2-z_1)+(\xi-\eta)(r_1-r_2)(z_4-z_3)]
  \end{aligned}
\end{equation}
公式(\ref{eq:32})可以化为：
\begin{equation}\label{eq:33}
  \begin{aligned}
 & \frac{du_O}{dt} \int_{-1}^{1}\int_{-1}^{1}\rho  \phi_c J d \xi d\eta\\
 &= \frac{1}{32}\frac{du_O}{dt} \int_{-1}^{1}\int_{-1}^{1}\rho (1+\xi)(1+\eta)[B+C(\xi-\eta)] d\xi d\eta
\end{aligned}
 \end{equation}
其中
 $B=(z_1-z_3)(r_4-r_2)+(z_2-z_4)(r_1-r_3)$，
  $C=(r_4-r_3)(z_2-z_1)+
(r_1-r_2)(z_4-z_3)$
公式 (\ref{eq:33}) 经过积分得到
\begin{equation}
  \begin{aligned}
	M=&\frac{1}{8}\rho_{IV} B\\
	=&\frac{1}{8} \rho_{IV}[(z_1-z_3)(r_4-r_2)+(z_2-z_4)(r_1-r_3)]
	=&\frac{1}{4} \rho_{IV}A_{IV}
	\end{aligned}
	\end{equation}


右侧以第一项为例：
\begin{equation}
  \begin{aligned}
	&\int_{\Omega_{IV}} \frac{\partial \sigma_{rr}}{\partial r}\phi_c d\Omega\\
	&=\int_{\Omega_{IV}} \frac{\partial \sigma_{rr}\phi_c}{\partial r} d\Omega-\int_{\Omega_{IV}} \frac{\partial \phi_c}{\partial r} \sigma_{rr} d\Omega\\
	=&-\sigma_{rr} \int_{-1}^1\int_{-1}^1 \frac{1}{J}\frac{\partial (z,\phi_c)}{\partial (\xi,\eta) } Jd\xi d\eta\\
	=&-\sigma_{rr} 
  \int_{-1}^1\int_{-1}^1 \frac{\partial (z,\phi_c)}{\partial (\xi,\eta) }d\xi d\eta\\
  =&-\sigma_{rr}\int_{-1}^1\int_{-1}^1 \frac{\partial z}{\partial \xi} \frac{\partial\phi_c}{\partial \eta} - \frac{\partial z}{\partial \eta}\frac{\partial \phi_c}{\partial \xi} d\xi d\eta\\
  =&-\frac{1}{4}\sigma_{rr}\int_{-1}^1\int_{-1}^1  \sum_{i=a}^d z_i \xi_i(1+\eta_i\eta)\frac{\partial \phi_c}{\partial \eta}- \sum_{i=a}^d z_i \eta_i(1+\xi_i\xi)\frac{\partial \phi_c}{\partial \xi}d\xi d\eta
  %=&\frac{1}{4}\int_{-1}^1\int_{-1}^1  \sum_{i=a}^d z_i \xi_i\frac{\partial\sigma_{rr}(\eta+\frac{1}{2}\eta_i\eta^2)}{\partial \eta}- \sum_{i=a}^d z_i \eta_i\frac{\partial\sigma_{rr}(\xi+\frac{1}{2}\xi_i\xi^2)}{\partial \xi}d\xi d\eta
\end{aligned}
\end{equation}
将$\phi_c$带入
\begin{equation}
  \begin{aligned}
	&-\frac{1}{16}\sigma_{rr}\int_{-1}^1\int_{-1}^1  \sum_{i=a}^d z_i \xi_i(1+\eta_i\eta)(1+\xi)- \sum_{i=a}^d z_i \eta_i(1+\xi_i\xi)(1+\eta)d\xi d\eta\\
	=&-\frac{1}{4}\sigma_{rr}(\sum_{i=a}^d z_i \xi_i-\sum_{i=a}^d z_i \eta_i)\\
	=&\frac{1}{2}\sigma_{rr}(z_d-z_b)\\
	=&\frac{1}{2}\sigma_{rr}(z_4-z_1)
\end{aligned}
\end{equation}
同理$IV$区右侧右侧第二项可以化为：
\begin{equation}
  \int_{\Omega_{IV}} \frac{\partial s_{rz}}{\partial z} \phi_c d\Omega=\frac{1}{2}s_{rzO}(r_1-r_4)
\end{equation}


在第$I$区，$O$点为第$d$节点，因此$\phi_d=1/4(1-\xi)(1+\eta)$ 其他求解过程和$IV$区相同，最后右侧积分变为：
\begin{equation}
  \begin{aligned}
  &\int_{\Omega_{I}}  \left(\frac{\partial \sigma_{rr}}{\partial r}+ \frac{\partial s_{rz}}{\partial z}\right) \phi_d d\Omega=\frac{1}{2}s_{rzO}(r_4-r_1) \\
  =&\frac{1}{2}\sigma_{rrO}(z_a-z_c)+\frac{1}{2}s_{rzO}(z_c-z_a)\\
  =&\frac{1}{2}\sigma_{rrO}(z_1-z_2)+\frac{1}{2}s_{rzO}(z_2-z_1)
  \end{aligned}
  \end{equation}

  将$I$-$IV$区左右项加和可得：
  \begin{equation}
  \frac{du_o}{dt}=\frac{1}{2M} \left[ \sum_{i=1}^4 s_{rzO}(r_{i+1}-r_{i}) -\sigma_{rrO}(z_{i+1}-z_i)\right]
  \end{equation}
  其中
\begin{equation}
  M=\frac{1}{4}(A_{ \uppercase\expandafter{\romannumeral 1}}\rho_{ \uppercase\expandafter{\romannumeral 1}}+A_{ \uppercase\expandafter{\romannumeral 2}}\rho_{ \uppercase\expandafter{\romannumeral 2}}+A_{ \uppercase\expandafter{\romannumeral 3}}\rho_{ \uppercase\expandafter{\romannumeral 3}}+A_{ \uppercase\expandafter{\romannumeral 4}}\rho_{ \uppercase\expandafter{\romannumeral 4}})
\end{equation}
和有限体积方法求得的公式(\ref{eq:34})相同。
\begin{figure}
  \centering
  \begin{tikzpicture}
	\coordinate (A) at (2,0);
	\coordinate (B) at (8,0.0);
	\coordinate (C) at (8.2,6.3);
	\coordinate (D) at (2.3,5.9);

	\coordinate (O) at (20.5/4, 12.2/4);
	\coordinate (AB) at (5, 0);
	\coordinate (BC) at (8.1, 3.15);
	\coordinate (CD) at (5.25, 6.1);
	\coordinate (AD) at (2.15, 2.95);
%
\draw [fill=black!10!red!10] (A)--(AB)--(O)--(AD);

\draw [line width=1pt, color=black!40] (A)--(B);
\draw [line width=1pt, color=black!40] (B)--(C);
\draw [line width=1pt, color=black!40] (C)--(D);
\draw [line width=1pt, color=black!40] (D)--(A);

\draw [line width=1.4pt, color=black!60] (O)--(AB);
\draw [line width=1.4pt, color=black!60] (O)--(BC);
\draw [line width=1.4pt, color=black!60] (O)--(CD);
\draw [line width=1.4pt, color=black!60] (O)--(AD);

%\draw [line width=1.6pt, color=black!80] (OA)--(AB2)--(OB);
%\draw [line width=1.6pt, color=black!80] (OB)--(BC2)--(OC);
%\draw [line width=1.6pt, color=black!80] (OC)--(CD2)--(OD);
%\draw [line width=1.6pt, color=black!80] (OD)--(AD2)--(OA);
%
%\draw [->>,line width=1.4pt, color=black!80!blue!80] (AB2)--(BC2);
%\draw [->>,line width=1.4pt, color=black!80!blue!80] (BC2)--(CD2);
%\draw [->>,line width=1.4pt, color=black!80!blue!80] (CD2)--(AD2);
%\draw [->>,line width=1.4pt, color=black!80!blue!80] (AD2)--(AB2);
%
%\node at (10.125/2-0.2,3.05/2-0.2) { \romannumeral 1};
%\node at (6.55625+0.2,1.55-0.2) { \romannumeral 2};
%\node at (13.225/2+0.2,3.1+0.2) { \romannumeral 3};
%\node at (6.66875+0.2,4.65+0.2) { \romannumeral 4};
%\node at (10.375/2-0.2,9.15/2+0.2) { \romannumeral 5};
%\node at (3.705625-0.2,4.5+0.2) { \romannumeral 6};
%\node at (7.275/2-0.2,3+0.2) { \romannumeral 7};
%\node at (3.56875-0.2,1.5-0.2) { \romannumeral 8};
%
\node at (20.5/4+0.2, 12.2/4+0.2) {\large O};
\node at (20.5/4-0.2, 12.2/4-0.2) {c};
\node at (20.5/4-0.2+2.7, 12.2/4-0.2) {c};
\node at (5,-0.3) {\large 1 };
\node at (4.6,0.3)  {\scriptsize b};
\node at (7.6,0.3)  {\scriptsize b};
\node at (2.4,0.3) {a};
\node at (5.4,0.3) {a};
\node at (8.4,3.15) {\large 2};
\node at (5.25,6.4) {\large 3};
\node at (1.85,2.95) {\large 4 };
\node at (2.4,2.65) {\scriptsize d};
\node at (5.4,2.8) {\scriptsize d};

\node at (3.,1.55) {\large \uppercase\expandafter{\romannumeral 4}};
\node at (3.,4.75) {\large \uppercase\expandafter{\romannumeral 3}};
\node at (7.3,4.95) {\large \uppercase\expandafter{\romannumeral 2}};
\node at (7.3,1.55) {\large \uppercase\expandafter{\romannumeral 1}};

\end{tikzpicture}
\caption{有限元求解动量方程控制单元示意图}
\label{fig:1}
\end{figure}

在计算中需要在动量方程中增加沙漏粘性$h$和人工粘性$q$，公式(\ref{eq:34}) 变为：

\begin{equation}\label{eq:37}
  M\frac{du}{dt}=\sum_{i=1}^4 \left( h_i+
\frac{1}{2}[s_{rz}(r_{i+1}-r_{i}) -(\sigma_{rr}-q_i)(z_{i+1}-z_i)]\right)
  \end{equation}
\subsubsection{能量方程离散}
能量守恒方程：
\begin{equation}\label{eq:35}
  \begin{aligned}
	&\displaystyle \rho \frac{de}{dt}= \bm{\sigma} \cdot \bm{\varepsilon}\\ 
	&=
	\sigma _{rr}\frac{\partial u}{\partial r}+\sigma_{zz}\frac{\partial v}{\partial z}+\sigma_{rz}\left( \frac{\partial u}{\partial z}+\frac{\partial v}{\partial r}\right)\\
& = -p \nabla \cdot \overrightarrow{u}+ s_{rr}\frac{\partial u}{\partial r}+s_{zz}\frac{\partial v}{\partial z}+s_{rz}\left( \frac{\partial u}{\partial z}+\frac{\partial v}{\partial r}\right)
	\end{aligned}
	\end{equation}

	通过质量守恒方程：
	\begin{equation}
	  \frac{\partial \rho}{\partial t}+\nabla\cdot (\rho \overrightarrow{u})=0
	\end{equation}
	有
	\begin{equation}
	  \frac{\partial \rho}{\partial t}+\overrightarrow{u} \cdot \nabla \rho + \rho  \nabla \cdot \overrightarrow{u}=0
	\end{equation}
	根据全微分关系
	\begin{equation}
	  \frac{d \rho}{d t}+ \rho  \nabla \cdot \overrightarrow{u}=0
	\end{equation}
	所以
	\begin{equation}
	  \begin{aligned}
	  \nabla\cdot \overrightarrow{u}& =-\frac{1}{\rho}\frac{d\rho}{dt}\\
	  &=-\frac{V}{m}\frac{d\frac{m}{V}}{dt}\\
	  &=\frac{1}{V}\frac{dV}{dt}
	  \end{aligned}
	  \end{equation}
	  所以方程(\ref{eq:35}) 可以化为
\begin{equation}
\rho \frac{de}{dt}
	= -\frac{p}{V}\frac{dV}{dt}+ s_{rr}\frac{\partial u}{\partial r}+s_{zz}\frac{\partial v}{\partial z}+s_{rz}\left( \frac{\partial u}{\partial z}+\frac{\partial v}{\partial r}\right)
 \end{equation}
 既
\begin{equation}
\frac{dE}{dt}
	= -p\frac{dV}{dt}+Vs_{rr}\frac{\partial u}{\partial r}+Vs_{zz}\frac{\partial v}{\partial z}+Vs_{rz}\left( \frac{\partial u}{\partial z}+V\frac{\partial v}{\partial r}\right)
 \end{equation}
	其中$\bm {\sigma}=-p\bm{I}+\bm{s}$。

	采用有限体积方法，在图\ref{fig:4} 所示整个单元上进行积分有，其中除速度外其它量均集中在单元中心$O$，因此有：
\begin{equation}
  \int_{\Omega}\frac{dE}{dt} d\Omega
  =\int_{\Omega} -p\frac{dV}{dt}+ V s_{rr}\frac{\partial u}{\partial r}+V s_{zz}\frac{\partial v}{\partial z}+ V s_{rz}\left( \frac{\partial u}{\partial z}+ \frac{\partial v}{\partial r}\right)d \Omega
 \end{equation}
 既
\begin{equation}
 \frac{dE}{dt} 
 =-p\frac{dV}{dt}+ \frac{1}{A} V s_{rr}\int_{\Omega}\frac{\partial u}{\partial r} d\Omega+V s_{zz} \frac{1}{A}\int_{\Omega}\frac{\partial v}{\partial z}d\Omega + V s_{rz}  \frac{1}{A}\int_{\Omega}\left( \frac{\partial u}{\partial z}+\frac{\partial v}{\partial r}\right)d \Omega
 \end{equation}
 以其中
 \begin{equation}
   \frac{1}{A}\int_{\Omega} \frac{\partial u}{\partial r} d\Omega
\end{equation}
的离散为例：
\begin{equation}
  \begin{aligned}
	\frac{1}{A}\int_{\Omega}  \frac{\partial u}{\partial r} d\Omega&=  -\frac{1}{A}\oint_{\partial \omega}u dz\\
	& \approx \frac{1}{A} (\frac{1}{2}(u_1+u_2)(z_2-z_1)+\frac{1}{2}(u_2+u_3)(z_3-z_2)\\
  & +(u_3+u_4)(z_4-z_3)+\frac{1}{2}(u_4+u_1)(u_1-u_4))\\
  &= -\frac{1}{A} \left((u_1-u_3)(z_2-z_4)+(u_2-u_4)(z_3-z_1)\right)
  \end{aligned}
\end{equation}
并将其记作$\bar{u}_{r}$。

\begin{figure}
  \centering
  \begin{tikzpicture}
	\coordinate (A) at (2,0);
	\coordinate (B) at (8,0.0);
	\coordinate (C) at (8.2,6.3);
	\coordinate (D) at (2.3,5.9);

	\coordinate (O) at (20.5/4, 12.2/4);
	\coordinate (AB) at (5, 0);
	\coordinate (BC) at (8.1, 3.15);
	\coordinate (CD) at (5.25, 6.1);
	\coordinate (AD) at (2.15, 2.95);
%
%	\coordinate (AB2) at (10.125/2, 3.05/2);
%	\coordinate (BC2) at (13.225/2, 3.1);
%	\coordinate (CD2) at (10.375/2, 9.15/2);
%	\coordinate (AD2) at (7.275/2, 3.);
%
%	\coordinate (OA) at (3.56875,1.5);
%	\coordinate (OB) at (6.55625,1.55);
%	\coordinate (OC) at (6.66875,4.65);
%	\coordinate (OD) at (3.705625,4.5);
%

%\draw [fill=black!10!red!10] (OA)--(OB)--(OC)--(OD);

\draw [line width=1pt, color=black!40] (A)--(B);
\draw [line width=1pt, color=black!40] (B)--(C);
\draw [line width=1pt, color=black!40] (C)--(D);
\draw [line width=1pt, color=black!40] (D)--(A);

\draw [line width=1.4pt, color=black!60] (O)--(AB);
\draw [line width=1.4pt, color=black!60] (O)--(BC);
\draw [line width=1.4pt, color=black!60] (O)--(CD);
\draw [line width=1.4pt, color=black!60] (O)--(AD);
%
%\draw [line width=1.6pt, color=black!80] (OA)--(AB2)--(OB);
%\draw [line width=1.6pt, color=black!80] (OB)--(BC2)--(OC);
%\draw [line width=1.6pt, color=black!80] (OC)--(CD2)--(OD);
%\draw [line width=1.6pt, color=black!80] (OD)--(AD2)--(OA);
%
%\draw [->>,line width=1.4pt, color=black!80!blue!80] (AB)--(BC);
%\draw [->>,line width=1.4pt, color=black!80!blue!80] (BC)--(CD);
%\draw [->>,line width=1.4pt, color=black!80!blue!80] (CD)--(AD);
%\draw [->>,line width=1.4pt, color=black!80!blue!80] (AD)--(AB);

%\node at (10.125/2-0.2,3.05/2-0.2) { \romannumeral 1};
%\node at (6.55625+0.2,1.55-0.2) { \romannumeral 2};
%\node at (13.225/2+0.2,3.1+0.2) { \romannumeral 3};
%\node at (6.66875+0.2,4.65+0.2) { \romannumeral 4};
%\node at (10.375/2-0.2,9.15/2+0.2) { \romannumeral 5};
%\node at (3.705625-0.2,4.5+0.2) { \romannumeral 6};
%\node at (7.275/2-0.2,3+0.2) { \romannumeral 7};
%\node at (3.56875-0.2,1.5-0.2) { \romannumeral 8};
%
\node at (20.5/4+0.2, 12.2/4+0.2) {\large O};
\node at (5,-0.3) {\large 1};
\node at (8.4,3.15) {\large 2};
\node at (5.25,6.4) {\large 3};
\node at (1.85,2.95) {\large 4};

%\node at (3.,1.55) {\large \uppercase\expandafter{\romannumeral 1}};
%\node at (3.,4.75) {\large \uppercase\expandafter{\romannumeral 2}};
%\node at (7.3,4.95) {\large \uppercase\expandafter{\romannumeral 3}};
%\node at (7.3,1.55) {\large \uppercase\expandafter{\romannumeral 4}};
%
\end{tikzpicture}
\caption{能量方程离散控制单元示意图}
\label{fig:4}
\end{figure}

能量方程空间离散为
\begin{equation}\label{eq:36}
  \frac{dE}{dt}=-p\frac{dV}{dt}+ V \bm{s}\cdot \bm{\varepsilon}
  \end{equation}
其中
  \begin{equation}
	\bm{s}\cdot \bm{\varepsilon}=s_{rr}\bar{u}_r+s_{zz}\bar{v}_z+s_{rz}(\bar{u}_z+\bar{v}_r)
\end{equation}

\subsubsection{本构方程离散}
和能量方程离散类似，以$\frac{ds_{rr}}{dt}$为例
\begin{equation}
  \frac{ds_{rr}}{dt}=2\mu\left(\bar{u}_r^n - \frac{1}{3}(\bar{u}_r^n+\bar{v}_z^n)\right)+s_{rz}^n(\bar{u}_z^n-\bar{v}_r^n)
\end{equation}



\section{求解流程}

\begin{figure}
	\centering
  \begin{tikzpicture}
	[auto,
	  block2/.style ={rectangle, draw=blue, thick,  
		align=center},
	  block/.style ={rectangle, draw=blue, thick,  
		align=center, rounded corners },
	  flow/.style ={rectangle, draw=red!40!black!50, thick,  
		align=center, rotate=90},
		  arrow/.style ={draw, thick,double,-implies}]
		  \node [block] at (3,1) {$(r,z)^n,\overrightarrow{u}^n$,$m^n$,$E^n$,$\bm{s}^n$};
		  \node [block2] at (3,0) {\hyperlink{fe2}{$h^n$},\hspace{0.2cm}\hyperlink{Fea}{$\Delta l^n$},\hspace{0.2cm} \hyperlink{Bul}{$q^n$}, \hspace{0.1cm} \hyperlink{Vol}{$V^n$},\hspace{0.2cm}\hyperlink{rho}{$\rho^n$},\hspace{0.2cm}\hyperlink{e}{$e^n$}};
		  
		  \node [block2] at (1,-1) {$\bm{s}^n$};
		  \node [block2] at (2.4,-1) {\hyperlink{rstres}{$\bm{\sigma}^*$}};
		  \node [block2] at (3.8,-1) {\hyperlink{fe2d10}{$\bm{s}^{n+\frac{1}{2}}$}};


		  \node [block2] at (1.3,-2) {$(r,z)^n$};
		  \node [block2] at (3.3,-2) {\hyperlink{upcc}{$(r,z)^{n+\frac{1}{2}}$}};
		  \node [block2] at (5.3,-2) {\hyperlink{v21}{$V^{n+\frac{1}{2}}$}};
		  \node [block2] at (7.0,-2) {\hyperlink{rho21}{$\rho^{n+\frac{1}{2}}$}};

		  \node [block2] at (1.1,-3) {$E^{n}$};
		  \node [block2] at (2.5,-3) {\hyperlink{e21}{$E^{n+\frac{1}{2}}$}};
		  \node [block2] at (9.2,-2.5) {\hyperlink{Eqos}{$p^{n+\frac{1}{2}}$}};
		  \node [flow] at (-2,-2) {预测步};
	\draw[arrow,blue](-0.4,0)--(0,0);
	\draw[arrow,blue](-0.4,-1)--(0,-1);
	\draw[arrow,blue](-0.4,-2)--(0,-2);
	\draw[arrow,blue](-0.4,-3)--(0,-3);
	\draw[arrow](1.5,-1)--(1.9,-1);
	\draw[arrow](2.8,-1)--(3.2,-1);
	\draw[arrow](2.0,-2)--(2.4,-2);
	\draw[arrow](4.2,-2)--(4.6,-2);
	\draw[arrow](6.0,-2)--(6.4,-2);

	\draw[arrow](1.55,-3)--(1.95,-3);

	\draw[arrow](8.0,-2.5)--(8.4,-2.5);

		  \draw[ thick, dashed] (-3,-3.5)--(11,-3.5){};
		  \node [flow] at (-2,-5) {校正步};

		  \node [block2] at (3.2,-4) {\hyperlink{Fea}{$ h^{n+\frac{1}{2}}$},\hspace{0.2cm}\hyperlink{fe2}{$\Delta l^{n+\frac{1}{2}}$},\hspace{0.2cm}  \hyperlink{Arfrc}{$\overrightarrow{F}^{n+\frac{1}{2}}$} ,\hspace{0.2cm}\hyperlink{m}{$m^{n+\frac{1}{2}}$}};

		  \node [block2] at (1.3,-5) {$\bm{s}^{n+\frac{1}{2}}$};
		  \node [block2] at (2.7,-5) {\hyperlink{rstres2}{$\bm{\sigma}^*$}};
		  \node [block2] at (4.1,-5) {\hyperlink{fe2d102}{$\bm{s}^{n+1}$}};

		  \node [block2] at (1.3,-6) {$\overrightarrow{F}^{n+\frac{1}{2}}$};
		  \node [block2] at (3.0,-6) {\hyperlink{a}{$\overrightarrow{a}^{n+\frac{1}{2}}$}};
		  \node [block2] at (6.,-6) {\hyperlink{updatecc}{$\overrightarrow{u}^{n+1}$,$\overrightarrow{u}^{n+\frac{1}{2}}$,$(r,z)^{n+1}$}};
		  \node [block2] at (9.0,-6) {\hyperlink{v21}{$V^{n+1}$}};
		  \node [block2] at (10.7,-6) {\hyperlink{rho21}{$\rho ^{n+1}$}};
		  \node [block2] at (1.4,-7) {$E^{n+\frac{1}{2}}$};
		  \node [block2] at (3.1,-7) {\hyperlink{e212}{$E^{n+1}$}};

		  \node [block2] at (11.2,-6.8) {\hyperlink{Eqos2}{$p^{n+1}$}};

	\draw[arrow](1.9,-5)--(2.3,-5);
	\draw[arrow](3.1,-5)--(3.5,-5);

	\draw[arrow](1.95,-6)--(2.35,-6);
	\draw[arrow](3.7,-6)--(4.1,-6);
	\draw[arrow](8.,-6)--(8.4,-6);
	\draw[arrow](9.7,-6)--(10.1,-6);

	\draw[arrow](2.1,-7)--(2.5,-7);
	\draw[arrow](10.2,-6.8)--(10.6,-6.8);

	\draw[arrow,blue](-0.4,-4)--(0,-4);
	\draw[arrow,blue](-0.4,-5)--(0,-5);
	\draw[arrow,blue](-0.4,-6)--(0,-6);
	\draw[arrow,blue](-0.4,-7)--(0,-7);

		  \draw[ thick, dashed] (-3,-7.5)--(11,-7.5){};
		  \draw[ thick, dashed] (-3,1.5)--(11,1.5){};
	\end{tikzpicture}
	\end{figure}

\setlength{\baselineskip}{20pt}

	\hypertarget{Fea}{ {\color{brown}Feahgq}：计算沙漏粘性$h$}

	\hypertarget{fe2}{ {\color{brown}fe2al}：计算特征长度$\Delta l$}

	\hypertarget{Bul}{  {\color{brown} Bukq}：计算人工粘性$q$}

	\hypertarget{Vol}{体积$V$:通过$(r,z)$坐标位置，计算单元体积}

	\hypertarget{rho}{密度$\rho$:通过$\rho=\frac{m}{V}$计算单元密度}

	\hypertarget{e}{比内能$e$:通过$e=\frac{E}{m}$计算}

	\hypertarget{rstres} {{\color{brown} rstres}}:更新应力旋转项：
	  \begin{equation}
		\begin{aligned}
		 & \sigma_{rr}^*=\sigma_{rr}^n+s_{rz}^n(u_z^n-v_r^n)\frac{\Delta t}{2}\\
		 & \sigma_{zz}^*=\sigma_{zz}^n+s_{rz}^n(u_z^n-v_r^n)\frac{\Delta t}{2}\\
		 & s_{rz}^*=s_{rz}^n+\frac{s_{zz}^n-s_{rr}^n}{2}(u_z^n-v_r^n)\frac{\Delta t}{2}
		  \end{aligned}
		  \end{equation}

		  \hypertarget{fe2d10}  {{\color{brown}fe2d10}} : 更新偏应力： 
		  \begin{equation}
\begin{aligned}
 & s_{rr}^{n+\frac{1}{2}}=\sigma_{rr}^* +p ^n +2\mu \left( u_r^n -\frac{1}{3} \nabla (u^n,v^n)\right)\frac{\Delta t}{2}\\
 & s_{zz}^{n+\frac{1}{2}}=\sigma_{zz}^* +p^n +2 \mu \left(v_z^n - \frac{1}{3}\nabla (u^n,v^n)\right)\frac{\Delta t}{2}\\
 & s_{rr}^{n+\frac{1}{2}}=s_{rz}^* +\mu(u_z^n+v_r^n)\frac{\Delta t}{2}\\
 & (s_{rr}^{n+\frac{1}{2}},s_{zz}^{n+\frac{1}{2}},s_{rz}^{n+\frac{1}{2}})=\Upsilon(s_{rr}^{n+\frac{1}{2}},s_{zz}^{n+\frac{1}{2}}s_{rz}^{n+\frac{1}{2}},Y^0)
 \end{aligned}
 \end{equation}

 \hypertarget{upcc}{更新坐标}
 \begin{equation}
   \begin{aligned}
  r^{n+\frac{1}{2}}=r^n+\frac{\Delta t}{2} u^n\\
  z^{n+\frac{1}{2}}=z^n+\frac{\Delta t}{2} v^n
  \end{aligned}
  \end{equation}

  \hypertarget{v21}{通过坐标$(r,z)$求解体积$V$}。

  \hypertarget{rho21}{通过$V$求解$\rho$:}
 \begin{equation} 
   \rho=\frac{m}{V}
   \end{equation}

   \hypertarget{e21}{ {\color{brown} ieupd\_ correct} :求解半点时刻能量}{ }
   能量方程空间离散过程见公式 (\ref{eq:36}) ， 
   \begin{equation}
	 E^{n+\frac{1}{2}}=E^n+ \bm{\sigma}^n :\bm{ \epsilon }^n\frac{\Delta t}{2}
	 \end{equation}

	 \hypertarget{Eqos}{ {\color{brown} Eqos}: 通过$p^{n+\frac{1}{2}}=p(\rho^{n+\frac{1}{2}},e^{n+\frac{1}{2}})$更新压力}
	

	 \hypertarget{Arfrc} {{\color{brown} Arfrc } 计算节点力 $F^{n+\frac{1}{2}}$ }
	 体力计算的具体公式见 (\ref{eq:37}): 
\begin{equation}
  F^{n+\frac{1}{2}}=\sum_{i=1}^4 \left( h_i^{n+\frac{1}{2}}+.5
  \frac{1}{2}[s_{rz}^{n+\frac{1}{2}}(r_{i+1}^{n+\frac{1}{2}}-r_{i}^{n+\frac{1}{2}}) -(\sigma_{rr}^{n+\frac{1}{2}}-q_i^{n+\frac{1}{2}})(z_{i+1}^{n+\frac{1}{2}}-z_i^{n+\frac{1}{2}})]\right)
  \end{equation}

  \hypertarget{m} {质量可以通过质量守恒定律(\ref{eq:38}) 求得}:
  \begin{equation}
    \frac{dm}{dt}=0
	\end{equation}


	\hypertarget{rstres2} {{\color{brown} rstres}}:更新应力旋转项：
	  \begin{equation}
		\begin{aligned}
		  & \sigma_{rr}^*=\sigma_{rr}^n+s_{rz}^{n+\frac{1}{2}}(u_z^{n+\frac{1}{2}}-v_r^{n+\frac{1}{2}})\Delta t\\
		  & \sigma_{zz}^*=\sigma_{zz}^n+s_{rz}^{n+\frac{1}{2}}(u_z^{n+\frac{1}{2}}-v_r^{n+\frac{1}{2}})\Delta t\\
		  & s_{rz}^*=s_{rz}^n+\frac{s_{zz}^{n+\frac{1}{2}}-s_{rr}^{n+\frac{1}{2}}}{2}(u_z^{n+\frac{1}{2}}-v_r^{n+\frac{1}{2}})\Delta t
		  \end{aligned}
		  \end{equation}

		  \hypertarget{fe2d102}  {{\color{brown}fe2d10}} : 更新偏应力： 
		  \begin{equation}
\begin{aligned}
  & s_{rr}^{n+1}=\sigma_{rr}^* +p ^n +2\mu \left( u_r^{n+\frac{1}{2}} -\frac{1}{3} \nabla (u^{n+\frac{1}{2}},v^{n+\frac{1}{2}})\right)\Delta t\\
  & s_{zz}^{n+1}=\sigma_{zz}^* +p^n +2 \mu \left(v_z^{n+\frac{1}{2}} - \frac{1}{3}\nabla (u^{n+\frac{1}{2}},v^{n+\frac{1}{2}})\right)\Delta t\\
  & s_{rr}^{n+1}=s_{rz}^* +\mu(u_z^{n+\frac{1}{2}}+v_r^{n+\frac{1}{2}})\Delta t\\
 & (s_{rr}^{n1},s_{zz}^{n+1},s_{rz}^{n+1})=\Upsilon(s_{rr}^{n+1},s_{zz}^{n+1}s_{rz}^{n+1},Y^0)
 \end{aligned}
 \end{equation}

 \hypertarget{a} {更新加速度$\overrightarrow{a}=\overrightarrow{F}/m$}

 \hypertarget{updatecc} { {\color{brown} update\_cc} ：}
\begin{equation}
\begin{aligned}
  & (u,v)^{n+1}=(u,v)^n+\Delta t (a_r,a_z)^{n+\frac{1}{2}}\\
  & (u,v)^{n+\frac{1}{2}}=\frac{(u,v)^n+(u,v)^{n+1}}{2}\\
  &(r,z)^{n+1}=(r,z)^n+\Delta t(u,v)^{n+\frac{1}{2}}
  \end{aligned}
  \end{equation}


   \hypertarget{e212}{ {\color{brown} ieupd\_ correct} :求解半点时刻能量}{ }
   能量方程空间离散过程见公式 (\ref{eq:36}) ， 
   \begin{equation}
	 E^{n+1}=E^n+ \bm{\sigma}^{n+\frac{1}{2}} :\bm{ \epsilon }^{n+\frac{1}{2}}\Delta t
	 \end{equation}



	 \hypertarget{Eqos2}{ {\color{brown} Eqos}: 通过$p^{n+1}=p(\rho^{n+1},e^{n+1})$更新压力}
 

		

	 \section*{附录I}\label{xx}
	 \subsection{Lame系数}
	 在沿$\xi_\alpha$坐标曲线上任取两点$M(x,y,z)$和$N(x+dx,y+dy,z+dz)$，那么MN沿$\xi_\alpha$ 弧微分为 $ds_\alpha= \sqrt{dx^2+dy^2+dz^2}$ ，由于曲线坐标系三个方向正交，在$\xi_\alpha$上有$d\xi_\beta=0,d\xi_\gamma=0$，因此有$dx=\frac{\partial x}{\partial \xi_\alpha} d\xi_\alpha$，同理$dy=\frac{\partial y}{\partial \xi_\alpha} d\xi_\alpha$和$dz=\frac{\partial z}{\partial \xi_\alpha}d\xi_\alpha$，即
	\begin{equation} 
	  ds_\alpha=\sqrt{\left(\frac{\partial x}{\partial \xi_\alpha}\right)^2+ \left(\frac{\partial y}{\partial \xi_\alpha}\right)^2+\left(\frac{\partial z}{\partial \xi_\alpha}\right)^2} d\xi_\alpha
	  \end{equation}
	  令
	 \begin{equation} 
	  h_\alpha=\sqrt{\left(\frac{\partial x}{\partial \xi_\alpha}\right)^2+ \left(\frac{\partial y}{\partial \xi_\alpha}\right)^2+\left(\frac{\partial z}{\partial \xi_\alpha}\right)^2}
	 \end{equation}
	 和
	 \begin{equation} 
	  h_\beta=\sqrt{\left(\frac{\partial x}{\partial \xi_\beta}\right)^2+ \left(\frac{\partial y}{\partial \xi_\beta}\right)^2+\left(\frac{\partial z}{\partial \xi_\beta}\right)^2}
	 \end{equation}
	 \begin{equation} 
	  h_\gamma=\sqrt{\left(\frac{\partial x}{\partial \xi_\gamma}\right)^2+ \left(\frac{\partial y}{\partial \xi_\gamma}\right)^2+\left(\frac{\partial z}{\partial \xi_\gamma}\right)^2}
	 \end{equation}
	 为Lame系数。
	 \begin{equation}
	   \begin{aligned}
	   &ds_\alpha= h_\alpha d\xi_\alpha\\
	   &ds_\beta= h_\beta d\xi_\beta\\
	   &ds_\gamma= h_\gamma d\xi_\gamma
	   \end{aligned}
	   \end{equation}
因此有
\begin{equation}
  \frac{\partial \bm{r}}{\partial \xi_\nu}=\frac{\partial \bm{r}}{\partial \xi_\nu}\frac{ds_\nu}{d \xi_\nu} = h_\nu \bm{e}_\nu
  \end{equation}
  \subsection{梯度公式}
\begin{equation}
  \nabla \phi = \frac{\partial \phi}{\partial x} \bm{i} + \frac{\partial \phi}{\partial y} \bm{j} +\frac{\partial \phi}{\partial z} \bm{k}
\end{equation}
又有
\begin{equation}
  \begin{aligned}
  &d\bm{r}= dx \bm{i} +dy\bm{j}+dz\bm{k}\\
  & d\phi = \frac{\partial \phi}{\partial x} dx +\frac{\partial \phi}{\partial y}+\frac{\partial \phi}{\partial z}dz 
  \end{aligned}
\end{equation}
可以得到
\begin{equation}
  \nabla \phi \cdot d\bm{r} = d\phi
  \end{equation}










\bibliography{../bib_list/mybibfile}



\end{document} 


